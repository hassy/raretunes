{% extends "base.html" %}
{% load markup recordingtags %}
{# {% load markup recordingtags audioplayer %} #}

{% block title %}{{ object.title }}{% endblock %}

{% block head_extra %}
<script src="/static/js/audiojs/audio.min.js"></script>
{% endblock %}
{% block js_docready %}
    // Setup the player to autoplay the next track
    var a = audiojs.createAll({
      trackEnded: function() {
        var next = $('li.playing').next();
        if (!next.length) next = $('li.recording').first();
        next.addClass('playing').siblings().removeClass('playing');
        audio.load(next.attr('data-src'));
        audio.play();
      }
    });
    // Load in the first track
    var audio = a[0];
    first = $('li.recording').attr('data-src');
    $('li.recording').first().addClass('playing');
    audio.load(first);
    // Load in a track on click
    $('li.recording a.track').click(function(e) {
      e.preventDefault();
      $(this).parent().parent().addClass('playing').siblings().removeClass('playing');
      audio.load($(this).parent().parent().attr('data-src'));
      audio.play();
    });
{% endblock %}

{% block body %}id="recordings"{% endblock %}

{% block content %}

<div class="article"><h1>{{ object.title }}</h1>
    <p>recorded: {{ object.recording_date|date:"F Y"|default:"-" }}</p>
    
    {{ object.note|textile }}

     <audio></audio> 

    <ol class="recordings">
            {% if object.published %}
              {% show_recording object %}
            {% endif %}
    </ol>


</div>
    
{% if object.music_img or object.abc %}
<div class="article"><h1>Music</h1>
    <p>
        {% if object.abc %}<a href="/recordings/abc/{{ object.slug }}">abc</a>{% endif %} |
        {% if object.music_img %}<a href="/media/{{ object.music_img }}">printed music</a>{% endif %}
    </p>
</div>
{% endif %}

<div class="article">
    <div class="info">
    <p>See the <a href="{{ object|archive_details_url }}">archive.org file page</a> for all available formats.</p>
    
    <p>{{ object.licence_type|licence|safe }}</p>

    {% ifnotequal object.licence_type "public_domain" %}
        <p>Please use these recordings as this license allows.<br/>
        {% if object.attribution_url %}Attribution to <a href="{{ object.attribution_url }}">{{ object.attribution_url }}</a> and the performer(s).{% endif %}</p>
    {% endifnotequal %}
    </div>
</div>

{% endblock %}